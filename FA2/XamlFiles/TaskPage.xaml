<Page x:Class="FA2.XamlFiles.TaskPage" 
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:converters="clr-namespace:FA2.Converters"
      xmlns:customControls="clr-namespace:FAIIControlLibrary.CustomControls;assembly=FAIIControlLibrary"
      Background="White" MinWidth="860" MinHeight="450"
      Title="TaskPage"
      Loaded="TaskPage_OnLoaded">
    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Themes\Generic.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <converters:BooleanToVisibilityConverter x:Key="VisibleOnTrueConverter" 
                                                     True="Visible" False="Collapsed"/>
            <converters:BooleanToVisibilityConverter x:Key="VisibleOnFalseConverter" 
                                                     True="Collapsed" False="Visible"/>
            <converters:CommentsConverter x:Key="CommentsConverter"/>
            

            <DataTemplate x:Key="TasksDataTemplate">
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock TextWrapping="Wrap" FontSize="16" 
                               Margin="10,0,0,0"
                               Text="{Binding TaskName}">
                        <TextBlock.Foreground>
                            <Binding Path="IsComplete">
                                <Binding.Converter>
                                    <converters:BooleanToBrushConverter False="#FF3366CC" 
                                                                        True="{StaticResource AdditTextBlackBrush}"/>
                                </Binding.Converter>
                            </Binding>
                        </TextBlock.Foreground>
                    </TextBlock>
                    <StackPanel Grid.Column="1">
                        <TextBlock Margin="5,2" FontSize="12" HorizontalAlignment="Right"
                                   Foreground="{DynamicResource AdditTextBlackBrush}"
                                   Text="{Binding GlobalID, StringFormat='(Задача №{0})', FallbackValue='Задача №---'}"/>
                        <TextBlock FontSize="12" Margin="5,0" HorizontalAlignment="Right" ToolTip="Дата создания"
                                   Foreground="{DynamicResource AdditTextBlackBrush}"
                                   Text="{Binding CreationDate, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}"/>
                        <TextBlock FontSize="12" HorizontalAlignment="Right" Margin="5,2"
                                   Text="{Binding TaskStatusID, Converter={StaticResource TaskConverter}, ConverterParameter='TaskStatusName'}"
                                   Foreground="{Binding TaskStatusID, Converter={StaticResource TaskConverter}, ConverterParameter='TaskStatusColor'}"/>
                    </StackPanel>
                    <Grid.InputBindings>
                        <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding DataContext.ShowTaskDetails,
                                      RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"/>
                    </Grid.InputBindings>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="PerformerDataTemplate">
                <Grid>
                    <Grid Margin="0,2" Background="#FFFAFAFA">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <Border Margin="5,6,5,4" BorderBrush="Gray"
                                    Background="Gray" CornerRadius="2" VerticalAlignment="Top"
                                    Width="{Binding ElementName=ImageBorder, Path=ActualWidth}"
                                    Height="{Binding ElementName=ImageBorder, Path=ActualHeight}">
                                <Border.Effect>
                                    <BlurEffect Radius="4"/>
                                </Border.Effect>
                            </Border>
                            <Border Grid.Column="0" Height="70" Width="55" BorderBrush="Gray"
                                    VerticalAlignment="Top" Margin="5" Name="ImageBorder"
                                    BorderThickness="0" CornerRadius="2" Background="White">
                                <Image Width="Auto" Height="Auto" Stretch="UniformToFill" Margin="1"
                                       VerticalAlignment="Center" HorizontalAlignment="Center"
                                       DataContext="{Binding WorkerID, Converter={StaticResource IdToStaffPhotoConverter}}" 
                                       Source="{Binding AsyncValue, NotifyOnSourceUpdated=True}"/>
                            </Border>
                            <Grid Grid.Column="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock FontSize="14" Margin="2,5,2,2" HorizontalAlignment="Left"
                                           Foreground="{DynamicResource BlueForeground}"
                                           Text="{Binding WorkerID, Converter={StaticResource IdToNameConverter}, ConverterParameter='ShortName'}"/>
                                <TextBlock Grid.Row="0" Margin="0,5,10,2" FontSize="14"
                                           HorizontalAlignment="Right"
                                           Text="{Binding TaskStatusID, Converter={StaticResource TaskConverter}, ConverterParameter='TaskStatusName'}"
                                           Foreground="{Binding TaskStatusID, Converter={StaticResource TaskConverter}, ConverterParameter='TaskStatusColor'}"/>
                                <TextBlock Grid.Row="1" Margin="2" FontSize="12"
                                           Text="{Binding StartDate, StringFormat='приступил: {0:dd.MM.yyyy}', FallbackValue='приступил: ---'}"/>
                                <TextBlock Grid.Row="2" Margin="2" FontSize="12"
                                           Text="{Binding CompletionDate, StringFormat='завершил: {0:dd.MM.yyyy}', FallbackValue='завершил: ---'}"/>
                                <TextBlock Grid.Row="3" Margin="2" FontSize="12">
                                    <TextBlock.Text>
                                        <Binding Path="SpendTime" ConverterParameter="FromMinutes" 
                                                 StringFormat="затрачено времени: {0}"
                                                 FallbackValue="затрачено времени: ---"
                                                 TargetNullValue="затрачено времени: не заполнено">
                                            <Binding.Converter>
                                                <converters:CombineConverter>
                                                    <converters:TimeSpanConverter/>
                                                    <converters:TimeSpanStringConverter/>
                                                </converters:CombineConverter>
                                            </Binding.Converter>
                                        </Binding>
                                    </TextBlock.Text>
                                </TextBlock>
                                <Button Grid.Row="4" Width="100" Margin="2,2,2,5" Content="Время"
                                        HorizontalAlignment="Left" Height="20"
                                        Style="{StaticResource BlueBtn}"
                                        Command="{Binding DataContext.TaskTimeTrackingInfo, 
                                        RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                        CommandParameter="{Binding}"/>
                            </Grid>
                        </Grid>
                    </Grid>
                    <Rectangle Height="1" Fill="LightGray" SnapsToDevicePixels="True"
                               VerticalAlignment="Bottom"/>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="AddCommentAttachmenTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Image Width="20" Height="20" Margin="2,0,0,0"
                           Source="{Binding Converter={StaticResource FileIconConverter}}"/>
                    <Button x:Name="ShowNewAttachmentButton" Margin="2" Grid.Column="1" 
                            ToolTip="Просмотреть" HorizontalAlignment="Left"
                            Style="{StaticResource LinkButton}"
                            Content="{Binding Converter={StaticResource FilePathToNameConverter}, 
                            ConverterParameter='WithExtension'}"
                            CommandParameter="{Binding}">
                        <Button.Command>
                            <Binding Path="DataContext.OpenNewCommentAttachmentCommand"
                                     RelativeSource="{RelativeSource AncestorType={x:Type Page}}"/>
                        </Button.Command>
                    </Button>
                    <Button x:Name="DeleteNewAttachmentButton" Grid.Column="2" Margin="5"
                            Content="×" FontWeight="Bold" Padding="0" ToolTip="Удалить"
                            HorizontalAlignment="Left"
                            CommandParameter="{Binding}">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource LinkButtonWhite}">
                                <Setter Property="Foreground" Value="Gray"/>
                            </Style>
                        </Button.Style>
                        <Button.Command>
                            <Binding Path="DataContext.DeleteNewCommentAttachmentCommand"
                                     RelativeSource="{RelativeSource AncestorType={x:Type Page}}"/>
                        </Button.Command>
                    </Button>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="CommentAttachmentTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Image x:Name="FileImage" Width="15" Height="15" Margin="5,0,0,0"
                           Source="{Binding CommentAttachmentName, Converter={StaticResource FileIconConverter}}"/>
                    <Button x:Name="FileName" Grid.Column="1" Margin="5" HorizontalAlignment="Left"
                            Foreground="#FF2E9D2E" VerticalAlignment="Center" FontWeight="Medium"
                            Content="{Binding CommentAttachmentName}"
                            Style="{StaticResource LinkButton}"
                            CommandParameter="{Binding}">
                        <Button.Command>
                            <Binding Path="DataContext.DownloadAndOpenCommentAttachmentCommand"
                                     RelativeSource="{RelativeSource AncestorType={x:Type Page}}"/>
                        </Button.Command>
                    </Button>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="CommentTemplate">
                <Grid MaxHeight="0">
                    <Grid.Background>
                        <Binding Path="CommentID"
                                 ConverterParameter="IsNewComment">
                            <Binding.Converter>
                                <converters:CombineConverter>
                                    <converters:CommentsConverter/>
                                    <converters:BooleanToBrushConverter True="#FFFFECB3"
                                                                        False="Transparent"/>
                                </converters:CombineConverter>
                            </Binding.Converter>
                        </Binding>
                    </Grid.Background>
                    <Rectangle Height="1" Fill="LightSteelBlue" VerticalAlignment="Bottom"
                               SnapsToDevicePixels="True"/>
                    <Grid Margin="2,5,2,2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="50"/>
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Border VerticalAlignment="Top" BorderBrush="Gray"
                                Background="Gray" CornerRadius="2" Margin="5,6,5,5"
                                Width="{Binding ElementName=ImageBorder, Path=ActualWidth}"
                                Height="{Binding ElementName=ImageBorder, Path=ActualHeight}">
                            <Border.Effect>
                                <BlurEffect Radius="7"/>
                            </Border.Effect>
                        </Border>
                        <Border x:Name="ImageBorder" VerticalAlignment="Top" BorderThickness="0"
                                BorderBrush="Gray" Background="White" CornerRadius="2" Margin="5"
                                SnapsToDevicePixels="True" Grid.Column="0">
                            <Image MinHeight="20" Margin="1"
                                   DataContext="{Binding WorkerID, Converter={StaticResource IdToStaffPhotoConverter}}" 
                                   Source="{Binding AsyncValue, NotifyOnSourceUpdated=True}"/>
                        </Border>
                        
                        <Grid Grid.Column="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition />
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Margin="2" TextTrimming="WordEllipsis" FontSize="16" 
                                       FontWeight="Normal" Foreground="#DD000000"
                                       Text="{Binding WorkerID, Converter={StaticResource IdToNameConverter}, 
                                       ConverterParameter='FullName', TargetNullValue='Гость'}"/>
                            
                            <StackPanel x:Name="EditCommentPanel" Orientation="Horizontal" Grid.Row="0"
                                        VerticalAlignment="Top" HorizontalAlignment="Right">
                                <StackPanel.Visibility>
                                    <Binding Path="CommentID"
                                             ConverterParameter="EditCommentButtonsEnable">
                                        <Binding.Converter>
                                            <converters:CombineConverter>
                                                <converters:CommentsConverter/>
                                                <converters:BooleanToVisibilityConverter True="Visible"
                                                                                         False="Collapsed"/>
                                            </converters:CombineConverter>
                                        </Binding.Converter>
                                    </Binding>
                                </StackPanel.Visibility>
                                <Button Name="EditCommentButton" Width="18" Height="18" Margin="0,0,2,0" 
                                        ToolTip="Редактировать" Padding="0"
                                        Style="{StaticResource GreenBtn}"
                                        Command="{Binding DataContext.EditCommentCommand,
                                        RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                        CommandParameter="{Binding}">
                                    <Button.Content>
                                        <Image Width="12" Height="12" VerticalAlignment="Center"
                                               HorizontalAlignment="Center" 
                                               Source="/Resources/EditNote.png"/>
                                    </Button.Content>
                                </Button>
                                <Button Name="DeleteCommentButton" Content="X" Width="18"
                                        Height="18" Padding="0" FontWeight="ExtraBold"
                                        ToolTip="Удалить"
                                        Style="{StaticResource RedBtn}"
                                        Command="{Binding DataContext.DeleteCommentCommand, 
                                        RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                        CommandParameter="{Binding}"/>
                            </StackPanel>

                            <!--Comment text-->
                            <TextBox x:Name="CommentText" Grid.Row="1" IsReadOnly="True" VerticalScrollBarVisibility="Auto"
                                     TextWrapping="Wrap" BorderBrush="{x:Null}" BorderThickness="0" Background="Transparent"
                                     FontSize="14" FontWeight="Regular" MaxLines="8" Foreground="#B2000000"
                                     Text="{Binding CommentText, Converter={StaticResource NewsTextConverter}, ConverterParameter='JustText', Mode=OneWay}"/>

                            <!--Attachments panel-->
                            <Grid Grid.Row="2"
                                  Visibility="{Binding ElementName=CommentAttachmentsItemsControl, Path=Items.IsEmpty, Converter={StaticResource VisibleOnFalseConverter}}">
                                <Rectangle Width="1" Margin="20,5,0,5" Fill="LightSteelBlue"
                                       HorizontalAlignment="Left"/>
                                <ItemsControl x:Name="CommentAttachmentsItemsControl" 
                                              MinHeight="0" Margin="21,0,0,0"
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                              ItemTemplate="{StaticResource CommentAttachmentTemplate}">
                                    <ItemsControl.ItemsSource>
                                        <Binding Path="CommentID"
                                                 Converter="{StaticResource CommentsConverter}"
                                                 ConverterParameter="CommentAttachmentsList"/>
                                    </ItemsControl.ItemsSource>
                                    <ItemsControl.Template>
                                        <ControlTemplate TargetType="{x:Type ItemsControl}">
                                            <ScrollViewer>
                                                <ItemsPresenter/>
                                            </ScrollViewer>
                                        </ControlTemplate>
                                    </ItemsControl.Template>
                                </ItemsControl>
                            </Grid>

                            <!--Comment last editing panel-->
                            <Grid Grid.Row="3"
                                  Visibility="{Binding ElementName=LastEditingText, Path=Text.IsEmpty, Converter={StaticResource VisibleOnFalseConverter}}">
                                <TextBlock Name="LastEditingText" Foreground="#89000000"
                                       Margin="3,0" FontSize="12" HorizontalAlignment="Left"
                                       Text="{Binding CommentText, Converter={StaticResource NewsTextConverter}, ConverterParameter='EditInfoText'}"/>
                            </Grid>

                            <!--Comment date panel-->
                            <StackPanel Grid.Row="4" Orientation="Horizontal" VerticalAlignment="Bottom" Margin="0,5,0,2">
                                <Image Height="12" Margin="2,0,0,0"
                                       Source="/Resources/clock.png"/>
                                <TextBlock FontWeight="Normal" Margin="5,0,0,0" Foreground="#B2000000" FontSize="12"
                                           Text="{Binding CommentDate, StringFormat='{}{0:dd.MM.yyyy HH:mm:ss}'}"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                    <Grid.Triggers>
                        <EventTrigger RoutedEvent="Control.Loaded">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation To="300" DecelerationRatio="0.8"
                                                     Duration="00:00:00.9" 
                                                     Storyboard.TargetProperty="(Grid.MaxHeight)"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Grid.Triggers>
                </Grid>
            </DataTemplate>


            <Style x:Key="TaskControlButtonStyle" TargetType="{x:Type Button}">
                <Setter Property="Height" Value="35"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Padding" Value="15,5"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Foreground" Value="{DynamicResource MainTextBlackBrush}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Button}">
                            <Grid Background="{TemplateBinding Background}">
                                <ContentPresenter Margin="{TemplateBinding Padding}" 
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Cursor" Value="Hand"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Cursor" Value="Arrow"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Foreground" 
                                            Value="{DynamicResource AdditTextBlackBrush}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            
            <Style x:Key="ShowCompletedCheckBoxStyle" TargetType="{x:Type CheckBox}">
                <Setter Property="Foreground" Value="{DynamicResource BlueForeground}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type CheckBox}">
                            <ContentPresenter/>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Cursor" Value="Hand"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Cursor" Value="Arrow"/>
                                </Trigger>
                                <Trigger Property="IsChecked" Value="False">
                                    <Setter Property="Foreground" Value="LightGray"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="PerformerModeRadioButtonStyle" TargetType="{x:Type RadioButton}">
                <Setter Property="Foreground" Value="{DynamicResource BlueForeground}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type RadioButton}">
                            <ContentPresenter/>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Cursor" Value="Hand"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Cursor" Value="Arrow"/>
                                </Trigger>
                                <Trigger Property="IsChecked" Value="False">
                                    <Setter Property="Foreground" Value="LightGray"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="{x:Type TextBlock}">
                <Setter Property="Foreground" Value="{DynamicResource MainTextBlackBrush}"/>
            </Style>
            
        </ResourceDictionary>
    </Page.Resources>

    <Border Margin="5" CornerRadius="1" BorderThickness="1"
            BorderBrush="DarkGray">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition/>
            </Grid.RowDefinitions>
            
            <Grid Background="#FFE0E0E0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="5">
                    <TextBlock Text="Дата с" VerticalAlignment="Center" FontSize="14"
                               Foreground="{DynamicResource AdditTextBlackBrush}"/>
                    <DatePicker Width="150" Height="30" Margin="5,0"
                                SelectedDate="{Binding DateFrom, Mode=TwoWay, NotifyOnSourceUpdated=True}"
                                Style="{DynamicResource CommonDatePickerStyle}"/>
                    <TextBlock Text="дата по" VerticalAlignment="Center" Margin="5,0,0,0" FontSize="14"
                               Foreground="{DynamicResource AdditTextBlackBrush}"/>
                    <DatePicker Width="150" Height="30" Margin="5,0"
                                SelectedDate="{Binding DateTo, Mode=TwoWay, NotifyOnSourceUpdated=True}"
                                Style="{DynamicResource CommonDatePickerStyle}"/>
                    <Button Content="Показать задачи" Width="150" Margin="5,0"
                            Command="{Binding Fill}"
                            Style="{StaticResource BlueBtn}"/>
                </StackPanel>
                <Button Width="150" HorizontalAlignment="Right" Margin="5"
                        Command="{Binding NewTask}"
                        Style="{StaticResource GreenBtn}">
                    <StackPanel Orientation="Horizontal">
                        <Grid>
                            <Rectangle Height="13" Width="3" Fill="White"/>
                            <Rectangle Height="3" Width="13" Fill="White"/>
                        </Grid>
                        <TextBlock Text="Новая задача" Foreground="White" Margin="10,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <Rectangle Height="1" Fill="LightGray"
                           VerticalAlignment="Bottom"/>
            </Grid>

            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>

                <Grid Grid.Row="1" Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    
                    <Grid>
                        <Grid.Visibility>
                            <Binding Path="WorkerFilteringEnable"
                                     Converter="{StaticResource VisibleOnTrueConverter}"
                                     FallbackValue="Collapsed"/>
                        </Grid.Visibility>
                        <Rectangle Height="1" VerticalAlignment="Bottom"
                                   SnapsToDevicePixels="True" Fill="LightGray"/>
                        <WrapPanel Orientation="Horizontal" Margin="10,0,0,0">
                            <TextBlock Text="Информация по работнику: " FontSize="14" Margin="0,5,0,0"
                                       FontFamily="Arrial" FontWeight="Medium"
                                       Foreground="{DynamicResource AdditTextBlackBrush}"/>
                            <TextBlock Margin="0,5" FontSize="14" 
                                       FontFamily="Arrial" FontWeight="Medium"
                                       Foreground="{DynamicResource AdditTextBlackBrush}">
                                <TextBlock.Text>
                                    <Binding Path="SelectedWorkerId"
                                             Converter="{StaticResource IdToNameConverter}"
                                             ConverterParameter="FullName"/>
                                </TextBlock.Text>
                            </TextBlock>
                        </WrapPanel>
                    </Grid>
                    
                    <Grid Grid.Row="1" Background="White">
                        <Grid.Style>
                            <Style TargetType="{x:Type Grid}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Opacity}" Value="0">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ShowTaskInfoDetailEnable}"
                                                 Value="True">
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard Name="HideAnimation">
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                 From="1" To="0" Duration="0:0:0.200"/>

                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                        <DataTrigger.ExitActions>
                                            <BeginStoryboard Name="ShowAnimation">
                                                <Storyboard>
                                                    <DoubleAnimation BeginTime="0:0:0.200" Duration="0:0:0.200"
                                                                 Storyboard.TargetProperty="Opacity" 
                                                                 From="0" To="1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.ExitActions>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition />
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <ListBox Grid.Row="1" Background="White" BorderThickness="0"
                                 ItemsSource="{Binding TasksView, Mode=TwoWay, NotifyOnSourceUpdated=True}"
                                 SelectedValuePath="TaskID" Margin="0,0,5,0"
                                 ScrollViewer.CanContentScroll="False"
                                 SelectedValue="{Binding SelectedTaskId, Mode=OneWay, NotifyOnSourceUpdated=True}"
                                 ItemTemplate="{StaticResource TasksDataTemplate}"
                                 SelectedItem="{Binding SelectedTaskRow, Mode=OneWayToSource}">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem" 
                                       BasedOn="{StaticResource LightListBoxItemStyle}">
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="MinHeight" Value="70"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="BorderBrush" Value="LightGray"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                                <Border SnapsToDevicePixels="True"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        Background="{TemplateBinding Background}">
                                                    <Grid>
                                                        <ContentPresenter/>
                                                        <Grid x:Name="ShowTaskDetailsPanel" Background="White"
                                                              Width="0" HorizontalAlignment="Right">
                                                            <Button x:Name="ShowTaskDetailsButton" Height="Auto"
                                                                    VerticalAlignment="Center" Margin="5,0"
                                                                    HorizontalAlignment="Left" Focusable="False"
                                                                    Foreground="{DynamicResource BlueForeground}"
                                                                    Command="{Binding DataContext.ShowTaskDetails, 
                                                                    RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}">
                                                                <Button.Template>
                                                                    <ControlTemplate TargetType="{x:Type Button}">
                                                                        <StackPanel Background="White">
                                                                            <Grid Height="25" Width="25">
                                                                                <Border x:Name="Border" CornerRadius="3" 
                                                                                        BorderThickness="3" 
                                                                                        BorderBrush="{TemplateBinding Foreground}"/>
                                                                                <Polygon x:Name="Polygon" StrokeThickness="2" Stroke="White"
                                                                                         Points="0,10 11,10 7,5 12,4 19,12.5 12,21 7,20 11,15 0,15"
                                                                                         Fill="{TemplateBinding Foreground}"/>
                                                                            </Grid>
                                                                            <TextBlock x:Name="TextBlock" Margin="0,2,0,0" 
                                                                                       Foreground="{TemplateBinding Foreground}">
                                                                            <Run>Перейти</Run>
                                                                            <LineBreak/>
                                                                            <Run>к задаче</Run>
                                                                            </TextBlock>
                                                                        </StackPanel>
                                                                        <ControlTemplate.Triggers>
                                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                                <Setter Property="Cursor" Value="Hand"/>
                                                                            </Trigger>
                                                                            <Trigger Property="IsPressed" Value="True">
                                                                                <Setter Property="Cursor" Value="Arrow"/>
                                                                            </Trigger>
                                                                        </ControlTemplate.Triggers>
                                                                    </ControlTemplate>
                                                                </Button.Template>
                                                            </Button>
                                                            <Rectangle Width="1" Fill="LightGray"
                                                                       HorizontalAlignment="Left"/>
                                                        </Grid>
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="WhiteSmoke"/>
                                                    </Trigger>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Trigger.EnterActions>
                                                            <BeginStoryboard Name="ShowAnimation">
                                                                <Storyboard>
                                                                    <DoubleAnimation Storyboard.TargetProperty="Width"
                                                                                     Storyboard.TargetName="ShowTaskDetailsPanel"
                                                                                     From="0" To="60" Duration="0:0:0.200"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.EnterActions>
                                                        <Trigger.ExitActions>
                                                            <BeginStoryboard Name="HideAnimation">
                                                                <Storyboard>
                                                                    <DoubleAnimation Storyboard.TargetProperty="Width"
                                                                                     Storyboard.TargetName="ShowTaskDetailsPanel"
                                                                                     From="60" To="0" Duration="0:0:0.200"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.ExitActions>
                                                        <Setter Property="BorderBrush" Value="{DynamicResource BlueForeground}"/>
                                                        <!--<Setter Property="BorderThickness" Value="0,0,0,1"/>-->
                                                        <Setter Property="Background" Value="{DynamicResource IsSelectedLightBackground}"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>

                        <Grid Grid.Row="2" Height="35"
                              Background="White">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>

                            <Button Style="{StaticResource TaskControlButtonStyle}"
                                    Visibility="{Binding StartTaskEnable, NotifyOnSourceUpdated=True, 
                                    Converter={StaticResource VisibleOnTrueConverter}, FallbackValue=Collapsed}"
                                    Command="{Binding StartTask}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Polygon Height="13" Width="13" SnapsToDevicePixels="True"
                                             HorizontalAlignment="Right" Points="0,0 13,6.5 0,13"
                                             Fill="{DynamicResource GreenForeground}"/>
                                    <TextBlock Grid.Column="1" Text="Приступить"
                                               Margin="10,0" VerticalAlignment="Center" 
                                               HorizontalAlignment="Left"
                                               Foreground="{DynamicResource GreenForeground}"/>
                                </Grid>
                            </Button>

                            <Button Grid.Column="0"
                                    Style="{StaticResource TaskControlButtonStyle}"
                                    Visibility="{Binding FinishTaskEnable, NotifyOnSourceUpdated=True, 
                                    Converter={StaticResource VisibleOnTrueConverter}, FallbackValue=Collapsed}"
                                    Command="{Binding EndTask}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Rectangle Height="13" Width="13" SnapsToDevicePixels="True"
                                               HorizontalAlignment="Right"
                                               Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type Button}}, Path=Foreground}"/>
                                    <TextBlock Grid.Column="1" Text="Завершить"
                                               Margin="10,0" VerticalAlignment="Center" 
                                               HorizontalAlignment="Left"
                                               Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type Button}}, Path=Foreground}"/>
                                </Grid>
                            </Button>

                            <Rectangle Grid.Column="1" Width="1" Fill="LightGray"
                                       HorizontalAlignment="Left"
                                       Visibility="{Binding FillTimeTrackingEnable, NotifyOnSourceUpdated=True, 
                                       Converter={StaticResource VisibleOnTrueConverter}, FallbackValue=Collapsed}"/>

                            <Button Grid.Column="1"
                                    Style="{StaticResource TaskControlButtonStyle}"
                                    Visibility="{Binding FillTimeTrackingEnable, NotifyOnSourceUpdated=True, 
                                    Converter={StaticResource VisibleOnTrueConverter}, FallbackValue=Collapsed}"
                                    Command="{Binding FillTimeTracking}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Label Width="27" Height="27" 
                                           Foreground="{DynamicResource BlueForeground}"
                                           Content="{StaticResource TimeGroupIcon}"/>
                                    <StackPanel Grid.Column="1" Margin="5,0,0,0"
                                            VerticalAlignment="Center">
                                        <TextBlock Text="Заполнить" Margin="0,0,0,-4"
                                                   Foreground="{DynamicResource BlueForeground}"/>
                                        <TextBlock Text="время выполнения" Margin="0,-4,0,0"
                                                   Foreground="{DynamicResource BlueForeground}"/>
                                    </StackPanel>
                                </Grid>
                            </Button>

                            <Rectangle Grid.Column="2" Width="1" Fill="LightGray"
                                       HorizontalAlignment="Left"/>

                            <Button Grid.Column="2" Content="Удалить"
                                    Style="{StaticResource TaskControlButtonStyle}"
                                    Command="{Binding DeleteTask}"
                                    IsEnabled="{Binding DeleteTaskEnable, NotifyOnSourceUpdated=True, FallbackValue=False}"/>

                            <Rectangle Grid.Column="3" Width="1" Fill="LightGray"
                                       HorizontalAlignment="Left"/>

                            <Button Grid.Column="3"
                                    Style="{StaticResource TaskControlButtonStyle}"
                                    Command="{Binding EditTask}"
                                    IsEnabled="{Binding DeleteTaskEnable, NotifyOnSourceUpdated=True, FallbackValue=False}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Label Width="27" Height="27"
                                           Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type Button}}, Path=Foreground}"
                                           Content="{StaticResource MainGroupIcon}"/>
                                    <TextBlock Grid.Column="1" Margin="5,0,0,0"
                                               VerticalAlignment="Center" Text="Редактировать"
                                               Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type Button}}, Path=Foreground}"/>
                                </Grid>
                            </Button>
                        </Grid>
                        
                        <Rectangle Grid.Row="2" Height="1" VerticalAlignment="Top"
                                   Fill="LightGray" SnapsToDevicePixels="True"/>
                        
                    </Grid>

                    <Grid Grid.Row="1" Background="White" Opacity="0">
                        <Grid.Style>
                            <Style TargetType="{x:Type Grid}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Opacity}" Value="0">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ShowTaskInfoDetailEnable}"
                                                 Value="True">
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard Name="ShowAnimation">
                                                <Storyboard>
                                                    <DoubleAnimation BeginTime="0:0:0.200" Duration="0:0:0.200"
                                                                     Storyboard.TargetProperty="Opacity" 
                                                                     From="0" To="1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                        <DataTrigger.ExitActions>
                                            <BeginStoryboard Name="HideAnimation">
                                                <Storyboard>
                                                    <DoubleAnimation Duration="0:0:0.200"
                                                                     Storyboard.TargetProperty="Opacity" 
                                                                     From="1" To="0"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.ExitActions>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition />
                        </Grid.RowDefinitions>

                        <Grid Background="#FFF5F5F5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Button VerticalAlignment="Top" Margin="10,10,5,5" Height="Auto"
                                    HorizontalAlignment="Left" Grid.Row="0"
                                    Foreground="{DynamicResource BlueForeground}"
                                    Command="{Binding BackToTasksListCommand}">
                                <Button.Template>
                                    <ControlTemplate TargetType="{x:Type Button}">
                                        <StackPanel Orientation="Horizontal"
                                                    Background="#F5F5F5">
                                            <Grid Height="25" Width="25">
                                                <Border x:Name="Border" CornerRadius="3" 
                                                        BorderThickness="3" 
                                                        BorderBrush="{TemplateBinding Foreground}"/>
                                                <Polygon x:Name="Polygon" StrokeThickness="2" Stroke="#F5F5F5"
                                                         Points="18,10 7,10 11,5 6,4 -1,12.5 6,21 11,20 7,15 18,15"
                                                         Fill="{TemplateBinding Foreground}"/>
                                            </Grid>
                                            <TextBlock x:Name="TextBlock" Margin="4,0,0,0" 
                                                   Foreground="{TemplateBinding Foreground}">
                                            <Run>Назад к</Run>
                                            <LineBreak/>
                                            <Run>списку задач</Run>
                                            </TextBlock>
                                        </StackPanel>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Cursor" Value="Hand"/>
                                            </Trigger>
                                            <Trigger Property="IsPressed" Value="True">
                                                <Setter Property="Cursor" Value="Arrow"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>

                            <Grid Grid.Row="1"
                                  DataContext="{Binding SelectedTaskRow}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock FontSize="18" Margin="10,0,5,5" TextWrapping="Wrap" FontWeight="Medium"
                                           Foreground="{DynamicResource BlueForeground}"
                                           Text="{Binding TaskName, StringFormat='Задача: {0}'}"/>
                                <StackPanel Grid.Row="1" Orientation="Horizontal">
                                    <TextBlock FontSize="14" Margin="10,5,5,5"
                                               Foreground="{DynamicResource AdditTextBlackBrush}"
                                               Text="{Binding GlobalID, StringFormat='№{0}'}"/>
                                    <TextBlock FontSize="14" Margin="5"
                                               Text="{Binding TaskStatusID, Converter={StaticResource TaskConverter}, 
                                                ConverterParameter='TaskStatusName', StringFormat='Статус: {0}'}"
                                               Foreground="{Binding TaskStatusID, Converter={StaticResource TaskConverter}, 
                                                ConverterParameter='TaskStatusColor'}"/>
                                </StackPanel>
                                <Rectangle Grid.Row="1" Height="1" VerticalAlignment="Bottom"
                                           Fill="LightGray" SnapsToDevicePixels="True"/>
                            </Grid>

                            <Grid Grid.Row="2" Height="35"
                                  Background="White">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>

                                <Button Style="{StaticResource TaskControlButtonStyle}"
                                        Visibility="{Binding StartTaskEnable, NotifyOnSourceUpdated=True, 
                                        Converter={StaticResource VisibleOnTrueConverter}, FallbackValue=Collapsed}"
                                        Command="{Binding StartTask}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <Polygon Height="13" Width="13" SnapsToDevicePixels="True"
                                                 HorizontalAlignment="Right" Points="0,0 13,6.5 0,13"
                                                 Fill="{DynamicResource GreenForeground}"/>
                                        <TextBlock Grid.Column="1" Text="Приступить"
                                                   Margin="10,0" VerticalAlignment="Center" 
                                                   HorizontalAlignment="Left"
                                                   Foreground="{DynamicResource GreenForeground}"/>
                                    </Grid>
                                </Button>

                                <Button Grid.Column="0"
                                        Style="{StaticResource TaskControlButtonStyle}"
                                        Visibility="{Binding FinishTaskEnable, NotifyOnSourceUpdated=True, 
                                        Converter={StaticResource VisibleOnTrueConverter}, FallbackValue=Collapsed}"
                                        Command="{Binding EndTask}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <Rectangle Height="13" Width="13" SnapsToDevicePixels="True"
                                                   HorizontalAlignment="Right"
                                                   Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type Button}}, Path=Foreground}"/>
                                        <TextBlock Grid.Column="1" Text="Завершить"
                                                   Margin="10,0" VerticalAlignment="Center" 
                                                   HorizontalAlignment="Left"
                                                   Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type Button}}, Path=Foreground}"/>
                                    </Grid>
                                </Button>

                                <Rectangle Grid.Column="1" Width="1" Fill="LightGray"
                                           HorizontalAlignment="Left"
                                           Visibility="{Binding FillTimeTrackingEnable, NotifyOnSourceUpdated=True, 
                                           Converter={StaticResource VisibleOnTrueConverter}, FallbackValue=Collapsed}"/>

                                <Button Grid.Column="1"
                                        Style="{StaticResource TaskControlButtonStyle}"
                                        Visibility="{Binding FillTimeTrackingEnable, NotifyOnSourceUpdated=True, 
                                        Converter={StaticResource VisibleOnTrueConverter}, FallbackValue=Collapsed}"
                                        Command="{Binding FillTimeTracking}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="Заполнить" Margin="0,0,0,-4"
                                                       Foreground="{DynamicResource BlueForeground}"/>
                                            <TextBlock Text="время выполнения" Margin="0,-4,0,0"
                                                       Foreground="{DynamicResource BlueForeground}"/>
                                        </StackPanel>
                                    </Grid>
                                </Button>

                                <Rectangle Grid.Column="2" Width="1" Fill="LightGray"
                                           HorizontalAlignment="Left"/>

                                <Button Grid.Column="2" Content="Удалить"
                                        Style="{StaticResource TaskControlButtonStyle}"
                                        Command="{Binding DeleteTask}"
                                        IsEnabled="{Binding DeleteTaskEnable, NotifyOnSourceUpdated=True, FallbackValue=False}"/>

                                <Rectangle Grid.Column="3" Width="1" Fill="LightGray"
                                           HorizontalAlignment="Left"/>

                                <Button Grid.Column="3"
                                        Style="{StaticResource TaskControlButtonStyle}"
                                        Command="{Binding EditTask}"
                                        IsEnabled="{Binding DeleteTaskEnable, NotifyOnSourceUpdated=True, FallbackValue=False}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="Редактировать"
                                                   Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type Button}}, Path=Foreground}"/>
                                    </Grid>
                                </Button>
                            </Grid>
                        </Grid>

                        <Grid Grid.Row="1" Background="#FFF5F5F5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition />
                            </Grid.RowDefinitions>

                            <ItemsControl Grid.Row="1" BorderThickness="0" Background="White"
                                          ScrollViewer.CanContentScroll="False" Margin="0,0,5,0"
                                          ItemTemplate="{StaticResource CommentTemplate}"
                                          ItemsSource="{Binding CommentsView, NotifyOnSourceUpdated=True, Mode=OneWay}"/>

                            <Rectangle Grid.Row="1" Margin="1,-1.5,1,0" Height="2" Grid.Column="1" Grid.ColumnSpan="2"
                                       VerticalAlignment="Top" Fill="#CC000000">
                                <Rectangle.Effect>
                                    <BlurEffect Radius="5" />
                                </Rectangle.Effect>
                            </Rectangle>

                            <Grid Grid.Row="0" Background="#FFF5F5F5">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Rectangle Height="1" VerticalAlignment="Top"
                                           Fill="LightGray" SnapsToDevicePixels="True"/>
                                <TextBlock Grid.Row="0" Text="Обсуждение" FontSize="16" Margin="10,5,5,5"
                                           FontWeight="Medium" HorizontalAlignment="Left"/>

                                <Button Grid.Row="0" Content="Добавить комментарий" Margin="5,0,10,0"
                                        FontSize="14" HorizontalAlignment="Right"
                                        Style="{StaticResource LinkButton}"
                                        Command="{Binding ShowAddingCommentPanelCommand}"
                                        IsEnabled="{Binding AddNewCommentEnable, Mode=OneWay, NotifyOnSourceUpdated=True}"
                                        Visibility="{Binding AddingCommentEnable, Converter={StaticResource VisibleOnFalseConverter}}"/>

                                <Grid Grid.Row="1" MaxHeight="0" Opacity="0">
                                    <Grid.Style>
                                        <Style TargetType="{x:Type Grid}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Opacity}" Value="0">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AddingCommentEnable}" Value="True">
                                                    <DataTrigger.EnterActions>
                                                        <BeginStoryboard Name="ShowAnimation">
                                                            <Storyboard>
                                                                <DoubleAnimation Duration="0:0:0.300"
                                                                                 Storyboard.TargetProperty="MaxHeight" 
                                                                                 DecelerationRatio="0.6"
                                                                                 From="0" To="200"/>
                                                                <DoubleAnimation Duration="0:0:0.200"
                                                                                 Storyboard.TargetProperty="Opacity" 
                                                                                 From="0" To="1"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.EnterActions>
                                                    <DataTrigger.ExitActions>
                                                        <BeginStoryboard Name="HideAnimation">
                                                            <Storyboard>
                                                                <DoubleAnimation Duration="0:0:0.250"
                                                                                 Storyboard.TargetProperty="MaxHeight"
                                                                                 DecelerationRatio="0.6"
                                                                                 From="200" To="0"/>
                                                                <DoubleAnimation Duration="0:0:0.250"
                                                                                 Storyboard.TargetProperty="Opacity" 
                                                                                 From="1" To="0"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.ExitActions>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Grid.Style>

                                    <Grid VerticalAlignment="Bottom">
                                        <Grid.RowDefinitions>
                                            <RowDefinition />
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <customControls:WatermarkTextBox VerticalContentAlignment="Top" TextWrapping="Wrap"
                                                                         AcceptsReturn="True" AcceptsTab="True"
                                                                         MinLines="4" BorderThickness="0,1"
                                                                         Background="White"
                                                                         VerticalScrollBarVisibility="Auto"
                                                                         HorizontalScrollBarVisibility="Disabled"
                                                                         WatermarkText="Текст комментария"
                                                                         WatermarkForeground="{DynamicResource AdditTextBlackBrush}"
                                                                         Foreground="{DynamicResource MainTextBlackBrush}"
                                                                         Text="{Binding CommentText, Mode=TwoWay}"/>
                                        <Grid Grid.Row="1" Margin="0,5,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="130"/>
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <Button Content="Прикрепить файл(ы)" 
                                                    Margin="5,0,5,5" Foreground="#FF2E9D2E"
                                                    VerticalAlignment="Top" HorizontalAlignment="Left"
                                                    Style="{StaticResource LinkButton}"
                                                    Command="{Binding SelectAttachmentsCommand}"
                                                    Visibility="{Binding CommentFileIsUploading, Converter={StaticResource VisibleOnFalseConverter}}"/>
                                            <ProgressBar Grid.Column="0" Margin="5" Height="5" 
                                                         VerticalAlignment="Top"
                                                         Value="{Binding CommentFileUploadingProgress, Mode=OneWay}"
                                                         Visibility="{Binding CommentFileIsUploading, Converter={StaticResource VisibleOnTrueConverter}}"/>
                                            <ItemsControl MaxHeight="80" MinHeight="0" 
                                                          Grid.Column="1" Margin="0,0,5,5"
                                                          ItemTemplate="{StaticResource AddCommentAttachmenTemplate}"
                                                          Visibility="{Binding RelativeSource={RelativeSource Self}, 
                                                          Path=Items.IsEmpty, Converter={StaticResource VisibleOnFalseConverter}}"
                                                          ItemsSource="{Binding CommentAttachmentsView, NotifyOnSourceUpdated=True, Mode=OneWay}">
                                                <ItemsControl.Template>
                                                    <ControlTemplate TargetType="{x:Type ItemsControl}">
                                                        <Border BorderThickness="1" CornerRadius="1"
                                                                BorderBrush="LightGray" SnapsToDevicePixels="True">
                                                            <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                                                                          CanContentScroll="False">
                                                                <StackPanel IsItemsHost="True"/>
                                                            </ScrollViewer>
                                                        </Border>
                                                    </ControlTemplate>
                                                </ItemsControl.Template>
                                            </ItemsControl>
                                        </Grid>
                                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="5"
                                                    HorizontalAlignment="Right" 
                                                    VerticalAlignment="Bottom">
                                            <Button x:Name="AddCommentButon" Content="Добавить"
                                                    Style="{StaticResource LinkButton}"
                                                    Command="{Binding AddNewCommentCommand}"/>
                                            <Button x:Name="CancelAddComment" Content="Отмена" 
                                                    Margin="10,0,5,0"
                                                    Style="{StaticResource LinkButton}"
                                                    Command="{Binding HideAddingCommentPanelCommand}"/>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                            </Grid>
                        </Grid>

                    </Grid>
                </Grid>

                <Rectangle Grid.Row="1" Grid.Column="1" HorizontalAlignment="Right" 
                           Width="3" Margin="1,1,-1,1" Fill="#88000000">
                    <Rectangle.Effect>
                        <BlurEffect Radius="5"/>
                    </Rectangle.Effect>
                </Rectangle>

                <Grid Grid.Row="1" Grid.Column="2" Background="White">     
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition />
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <ItemsControl Grid.Row="1" BorderThickness="0"
                                  ItemTemplate="{StaticResource PerformerDataTemplate}"
                                  ItemsSource="{Binding PerformerView, Mode=TwoWay, NotifyOnSourceUpdated=True}">
                        <ItemsControl.Template>
                            <ControlTemplate TargetType="{x:Type ItemsControl}">
                                <Grid>
                                    <ScrollViewer CanContentScroll="False">
                                        <StackPanel IsItemsHost="True"/>
                                    </ScrollViewer>
                                    <TextBlock Text="Ничего не выбрано" 
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"
                                               Foreground="{DynamicResource AdditTextBlackBrush}">
                                        <TextBlock.Visibility>
                                            <Binding Path="Items.IsEmpty"
                                                     Converter="{StaticResource VisibleOnTrueConverter}">
                                                <Binding.RelativeSource>
                                                    <RelativeSource AncestorType="{x:Type ItemsControl}"/>
                                                </Binding.RelativeSource>
                                            </Binding>
                                        </TextBlock.Visibility>
                                    </TextBlock>
                                </Grid>
                            </ControlTemplate>
                        </ItemsControl.Template>
                    </ItemsControl>

                    <Rectangle Grid.Row="1" HorizontalAlignment="Stretch" 
                               Height="2" Margin="1,-1.5,1,0"
                               SnapsToDevicePixels="True"
                               VerticalAlignment="Top" Fill="#EE000000">
                        <Rectangle.Effect>
                            <BlurEffect Radius="5"/>
                        </Rectangle.Effect>
                    </Rectangle>

                    <Grid Grid.Row="0"
                          DataContext="{Binding SelectedTaskRow}"
                          Background="#FFF5F5F5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Постановщик:" FontSize="16" 
                                   Margin="5,2" FontWeight="Medium"/>

                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>

                            <Grid VerticalAlignment="Top">
                                <Border Margin="5,6,5,4" BorderBrush="Gray"
                                        Background="Gray" CornerRadius="2"
                                        Width="{Binding ElementName=ImageBorder, Path=ActualWidth}"
                                        Height="{Binding ElementName=ImageBorder, Path=ActualHeight}">
                                    <Border.Effect>
                                        <BlurEffect Radius="4"/>
                                    </Border.Effect>
                                </Border>
                                <Border Name="ImageBorder" Height="70" Width="55" 
                                        BorderThickness="0" BorderBrush="Gray" 
                                        Background="White" SnapsToDevicePixels="True" 
                                        Margin="5" CornerRadius="2">
                                    <Image Width="Auto" Height="Auto" Stretch="UniformToFill" Margin="1"
                                           VerticalAlignment="Center" HorizontalAlignment="Center"
                                           DataContext="{Binding MainWorkerID, Converter={StaticResource IdToStaffPhotoConverter}}" 
                                           Source="{Binding AsyncValue, NotifyOnSourceUpdated=True}"/>
                                </Border>
                            </Grid>

                            <StackPanel Grid.Column="1" HorizontalAlignment="Left">
                                <TextBlock FontSize="16" Margin="5,2"
                                           Foreground="{DynamicResource GreenForeground}"
                                           Text="{Binding MainWorkerID, Converter={StaticResource IdToNameConverter}, ConverterParameter='ShortName'}"/>
                                <TextBlock Margin="5,2" FontSize="14"
                                           Text="{Binding CreationDate, StringFormat='дата создания: {0:dd.MM.yyyy}', FallbackValue='дата создания: ---'}"/>
                                <TextBlock Margin="5,2" FontSize="14"
                                           Text="{Binding CompletionDate, StringFormat='дата завершения: {0:dd.MM.yyyy}', FallbackValue='дата завершения: ---'}"/>
                                <TextBlock Margin="5,2" FontSize="14"
                                           Text="{Binding DeadLine, StringFormat='крайний срок: {0:dd.MM.yyyy}',
                                           FallbackValue='крайний срок: ---', TargetNullValue='крайний срок не задан'}">
                                    <TextBlock.Foreground>
                                        <Binding Path="IsDeadLine" FallbackValue="#DD000000">
                                            <Binding.Converter>
                                                <converters:BooleanToBrushConverter True="#FFD84A35" 
                                                                                    False="#DD000000"/>
                                            </Binding.Converter>
                                        </Binding>
                                    </TextBlock.Foreground>
                                </TextBlock>
                                <WrapPanel Orientation="Horizontal">
                                    <TextBlock Text="описание задачи:" Margin="5,2,0,2" FontSize="14"/>
                                    <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                                                  VerticalScrollBarVisibility="Auto" MaxHeight="100">
                                        <TextBlock FontSize="14" Margin="5,2" TextWrapping="Wrap"
                                                   Foreground="{DynamicResource MainTextBlackBrush}"
                                                   Text="{Binding Description, FallbackValue='---'}"/>
                                    </ScrollViewer>
                                </WrapPanel>
                            </StackPanel>

                        </Grid>

                        <TextBlock Grid.Row="2" Text="Ответственные" Margin="5,10,5,2" 
                                   FontSize="16" FontWeight="Medium"/>

                    </Grid>

                    <Grid Grid.Row="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid Background="#FFF5F5F5" Height="35">
                            <TextBlock Text="Наблюдатели" HorizontalAlignment="Left"
                                       VerticalAlignment="Center" Margin="5,2" 
                                       FontSize="16" FontWeight="Medium"/>
                            <Button Content="Стать наблюдателем" HorizontalAlignment="Right"
                                    FontSize="14" Margin="5,2" Width="200"
                                    Command="{Binding AddToObserversCommand}">
                                <Button.Visibility>
                                    <Binding Path="AddingToObserversEnable"
                                             Converter="{StaticResource VisibleOnTrueConverter}"
                                             FallbackValue="Collapsed"/>
                                </Button.Visibility>
                            </Button>
                            <Rectangle Height="1" SnapsToDevicePixels="True"
                                       VerticalAlignment="Top" Fill="LightGray"/>
                            <Rectangle Height="1" SnapsToDevicePixels="True" Fill="LightGray"
                                       VerticalAlignment="Bottom">
                                <Rectangle.Visibility>
                                    <Binding ElementName="ObserversItemsControl"
                                             Path="Items.IsEmpty"
                                             Converter="{StaticResource VisibleOnFalseConverter}"/>
                                </Rectangle.Visibility>
                            </Rectangle>
                        </Grid>
                        <ItemsControl Name="ObserversItemsControl" Grid.Row="1" BorderThickness="0"
                                      ScrollViewer.CanContentScroll="False" MaxHeight="70" Padding="2"
                                      ItemsSource="{Binding ObserversView, Mode=TwoWay, NotifyOnSourceUpdated=True}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderThickness="1" CornerRadius="1" BorderBrush="LightGray"
                                            SnapsToDevicePixels="True" Margin="2" Width="150">
                                        <Grid Background="WhiteSmoke">
                                            <TextBlock VerticalAlignment="Center" Margin="5,0" 
                                                       FontWeight="Medium" FontSize="16"
                                                       Foreground="{DynamicResource MainTextBlackBrush}"
                                                       Text="{Binding WorkerID, Converter={StaticResource IdToNameConverter}, 
                                                       ConverterParameter='ShortName'}"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.Template>
                                <ControlTemplate TargetType="{x:Type ItemsControl}">
                                    <ScrollViewer CanContentScroll="False"
                                                  HorizontalScrollBarVisibility="Disabled"
                                                  Padding="{TemplateBinding Padding}">
                                        <WrapPanel IsItemsHost="True"/>
                                    </ScrollViewer>
                                </ControlTemplate>
                            </ItemsControl.Template>
                            <ItemsControl.Visibility>
                                <Binding RelativeSource="{RelativeSource Self}"
                                         Path="Items.IsEmpty"
                                         Converter="{StaticResource VisibleOnFalseConverter}"/>
                            </ItemsControl.Visibility>
                        </ItemsControl>
                    </Grid>

                </Grid>

                <Rectangle Grid.Row="1" HorizontalAlignment="Stretch" 
                           Margin="1,-1.5,1,0" Height="2" Grid.Column="1" Grid.ColumnSpan="2"
                           VerticalAlignment="Top" Fill="#CC000000">
                    <Rectangle.Effect>
                        <BlurEffect Radius="5" />
                    </Rectangle.Effect>
                </Rectangle>

                <Grid Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="2" Background="#FFF5F5F5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                            <RadioButton Margin="10,5" FontSize="12"
                                                 Style="{StaticResource PerformerModeRadioButtonStyle}"
                                                 IsChecked="{Binding IsPerformed, Mode=TwoWay, NotifyOnSourceUpdated=True}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Label Width="25" Height="25" Padding="2"
                                                       Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type RadioButton}}, Path=Foreground}"
                                                       Content="{DynamicResource ManIcon}"/>
                                        <Polygon VerticalAlignment="Center" SnapsToDevicePixels="True"
                                                         Points="14,9 6,9 10,5 7,4 0,10.5 7,17 10,16 6,12 14,12"
                                                         Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type RadioButton}}, Path=Foreground}"/>
                                    </StackPanel>
                                    <TextBlock Text="Личные" Margin="0,-3,0,0" FontWeight="Medium"
                                                       Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type RadioButton}}, Path=Foreground}"/>
                                </StackPanel>
                            </RadioButton>
                            <RadioButton Margin="10,5" FontSize="12"
                                                 Style="{StaticResource PerformerModeRadioButtonStyle}"
                                                 IsChecked="{Binding IsCharged, Mode=TwoWay, NotifyOnSourceUpdated=True}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Label Width="25" Height="25" Padding="2"
                                                       Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type RadioButton}}, Path=Foreground}"
                                                       Content="{DynamicResource ManIcon}"/>
                                        <Polygon VerticalAlignment="Center" SnapsToDevicePixels="True"
                                                         Points="0,9 8,9 4,5 7,4 14,10.5 7,17 4,16 8,12 0,12"
                                                         Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type RadioButton}}, Path=Foreground}"/>
                                    </StackPanel>
                                    <TextBlock Text="Поставленные" Margin="0,-3,0,0" FontWeight="Medium"
                                                       Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type RadioButton}}, Path=Foreground}"/>
                                </StackPanel>
                            </RadioButton>
                            <RadioButton Margin="10,5" FontSize="12"
                                         Style="{StaticResource PerformerModeRadioButtonStyle}"
                                         IsChecked="{Binding IsObserved, Mode=TwoWay, NotifyOnSourceUpdated=True}"
                                         Visibility="{Binding FullAccess, Converter={StaticResource VisibleOnTrueConverter}, FallbackValue='Collapsed'}">
                                <StackPanel>
                                    <Label Width="25" Height="25" Padding="0"
                                           Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type RadioButton}}, Path=Foreground}"
                                           Content="{StaticResource EyeIcon}"/>
                                    <TextBlock Text="Наблюдаемые" Margin="0,-3,0,0" FontWeight="Medium"
                                               Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type RadioButton}}, Path=Foreground}"/>
                                </StackPanel>
                            </RadioButton>
                        </StackPanel>
                        <Rectangle Width="1" Grid.Column="1" HorizontalAlignment="Left"
                                   SnapsToDevicePixels="True" Fill="LightGray"/>
                        <CheckBox Grid.Column="1" Margin="10,2"
                                          FontSize="12" HorizontalAlignment="Left"
                                          Style="{StaticResource ShowCompletedCheckBoxStyle}"
                                          IsChecked="{Binding ShowCompleted, Mode=TwoWay, NotifyOnSourceUpdated=True}">
                            <StackPanel Orientation="Horizontal">
                                <Label Width="25" Height="25" Padding="3,6,5,2"
                                               Content="{StaticResource TasksIcon}"
                                               Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type CheckBox}}, Path=Foreground}"/>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Показать" FontWeight="Medium" Margin="4,0,0,-1"
                                                       Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type CheckBox}}, Path=Foreground}"/>
                                    <TextBlock Text="завершённые" FontWeight="Medium" Margin="4,-1,0,0"
                                                       Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type CheckBox}}, Path=Foreground}"/>
                                </StackPanel>
                            </StackPanel>
                        </CheckBox>
                        <Rectangle Width="1" Grid.Column="2" HorizontalAlignment="Left"
                                   SnapsToDevicePixels="True" Fill="LightGray"/>
                        <CheckBox Grid.Column="2" Margin="10,5"
                                  FontSize="12" HorizontalAlignment="Left"
                                  Style="{StaticResource ShowCompletedCheckBoxStyle}"
                                  IsChecked="{Binding WorkerFilteringEnable, Mode=TwoWay, NotifyOnSourceUpdated=True}">
                            <CheckBox.Visibility>
                                <Binding Path="FullAccess"
                                                 Converter="{StaticResource VisibleOnTrueConverter}"
                                                 FallbackValue="Collapsed"/>
                            </CheckBox.Visibility>
                            <StackPanel Orientation="Horizontal">
                                <Label Width="25" Height="25" Padding="2"
                                               Content="{StaticResource ManIcon}"
                                               Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type CheckBox}}, Path=Foreground}"/>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Информация" FontWeight="Medium" 
                                                   VerticalAlignment="Center" Margin="4,0,0,-1"
                                                   Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type CheckBox}}, Path=Foreground}"/>
                                    <TextBlock Text="по работникам" FontWeight="Medium" 
                                                       VerticalAlignment="Center" Margin="4,-1,0,0"
                                                   Foreground="{Binding RelativeSource={RelativeSource AncestorType={x:Type CheckBox}}, Path=Foreground}"/>
                                </StackPanel>
                            </StackPanel>
                        </CheckBox>
                    </Grid>
                </Grid>

                <Rectangle Width="2" Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
                           Fill="#CC000000" Margin="-1,1,0,1" HorizontalAlignment="Left">
                    <Rectangle.Visibility>
                        <Binding Path="WorkerFilteringEnable"
                                 Converter="{StaticResource VisibleOnTrueConverter}"/>
                    </Rectangle.Visibility>
                    <Rectangle.Effect>
                        <BlurEffect Radius="5"/>
                    </Rectangle.Effect>
                </Rectangle>

                <Grid Grid.Row="0" Grid.Column="0" Grid.RowSpan="2" Width="0" Opacity="0">
                    <Grid.Style>
                        <Style TargetType="{x:Type Grid}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Opacity}" Value="0">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding WorkerFilteringEnable}"
                                             Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard Name="ShowAnimation">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                 To="1" Duration="0:0:0.200"/>
                                                <DoubleAnimation Storyboard.TargetProperty="Width"
                                                                 To="250" Duration="0:0:0.200"
                                                                 DecelerationRatio="0.8"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard Name="HideAnimation">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                 To="0" Duration="0:0:0.200"/>
                                                <DoubleAnimation Storyboard.TargetProperty="Width"
                                                                 To="0" Duration="0:0:0.200"
                                                                 DecelerationRatio="0.8"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Grid Width="250" HorizontalAlignment="Right" Background="White"
                          Visibility="{Binding FullAccess, Converter={StaticResource VisibleOnTrueConverter}}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Background="#FFF5F5F5"
                              IsEnabled="{Binding WorkerFilteringEnable, NotifyOnSourceUpdated=True}">
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Группа" VerticalAlignment="Center" 
                                       FontSize="14" Margin="5,0"
                                       Foreground="{DynamicResource AdditTextBlackBrush}"/>
                            <ComboBox Grid.Row="0" Grid.Column="1" Height="30" Margin="5"
                                      SelectedValuePath="WorkerGroupID"
                                      DisplayMemberPath="WorkerGroupName"
                                      ItemsSource="{Binding WorkerGroupsView, NotifyOnSourceUpdated=True}"
                                      SelectedValue="{Binding SelectedWorkerGroupId, Mode=TwoWay, NotifyOnSourceUpdated=True}"/>
                            <TextBlock Text="Фабрика" Grid.Row="1" Grid.Column="0"
                                       VerticalAlignment="Center" FontSize="14" Margin="5,0"
                                       Foreground="{DynamicResource AdditTextBlackBrush}"/>
                            <ComboBox Grid.Row="1" Grid.Column="1" Height="30" Margin="5"
                                      SelectedValuePath="FactoryID"
                                      DisplayMemberPath="FactoryName"
                                      ItemsSource="{Binding FactoriesView, NotifyOnSourceUpdated=True}"
                                      SelectedValue="{Binding SelectedFactoryId, Mode=TwoWay, NotifyOnSourceUpdated=True}"/>
                        </Grid>
                        <Rectangle Grid.Row="1" Fill="LightGray"
                                   SnapsToDevicePixels="True" Height="1"
                                   VerticalAlignment="Top"/>
                        <ListBox SelectedValuePath="WorkerID" Margin="0,2,0,0"
                                 DisplayMemberPath="Name" Grid.Row="1" BorderThickness="0"
                                 ItemsSource="{Binding WorkersView, NotifyOnSourceUpdated=True}"
                                 SelectedValue="{Binding SelectedWorkerId, Mode=TwoWay, NotifyOnSourceUpdated=True}"
                                 IsEnabled="{Binding WorkerFilteringEnable, NotifyOnSourceUpdated=True}"/>
                        <Grid Grid.Row="2" 
                              Background="{DynamicResource MidBackground}">
                            <Button Content="Экспортировать отчёт" Margin="5"
                                    Style="{StaticResource GreenBtn}"
                                    Command="{Binding ExportToExcelCommand}"/>
                        </Grid>
                    </Grid>
                </Grid>

            </Grid>
        </Grid>
    </Border>
</Page>
